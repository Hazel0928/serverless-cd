steps:
  - run: npm install @serverless-devs/s -g  --registry=https://registry.npmmirror.com
  - run: s -v
  - run: s config add --AccountID ${{secrets.ACCOUNTID}}  --AccessKeyID ${{secrets.ACCESS_KEY_ID}}  --AccessKeySecret ${{secrets.ACCESS_KEY_SECRET}} -a default -f
  - run: s deploy --use-local -y -t ./src/serverless-cd.yaml
  - name: 钉钉通知
    plugin: "@serverless-cd/ding-talk"
    inputs:
      webhook: https://oapi.dingtalk.com/robot/send?access_token=${{secrets.WEBHOOK_ACCESS_TOKEN}}
      msgtype: markdown
      payload:
        title: "Serverless CD"
        text: "serverless cd 部署${{failure() ? '失败' : '成功'}}"
