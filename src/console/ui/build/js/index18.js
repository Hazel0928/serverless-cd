import{C as e,p as t,_ as a,d as r,e as s,R as n,i as l,j as o,Z as i,N as p,M as c,f as m,r as u,P as d,s as g,v as f,a4 as h,A as y,z as E,a as v,l as x,L as b,h as N,T as S,b as k}from"./index.js";import{P}from"./index3.js";import{r as C,g as I,a as w}from"./task.js";import{a as z,S as O}from"./DeployStatus.js";import{b as _,N as j,w as L,B as T}from"./index7.js";import{D}from"./index11.js";import{T as R,C as Y}from"./CopyIcon.js";import{N as $,a as H,S as G}from"./index12.js";import{R as M,C as F}from"./CancelDeploy.js";import{s as A,f as V}from"./index10.js";import{D as B,P as J,S as W,a as q}from"./SecretDrawer.js";import{N as U}from"./index5.js";import{N as K,a as Z}from"./index8.js";import{C as Q}from"./repository.js";import{u as X,T as ee,I as te,a as ae,b as re,d as se}from"./Trigger.js";import"./index6.js";import"./Secret.js";var ne,le,oe=$.Option,ie=function e(){};function pe(e,t,a){var r=ce(t,a);return e>r?r:e}function ce(e,t){var a=Math.ceil(e/t);return a<=0?1:a}var me=(le=ne=function(e){function t(a,n){r(this,t);var l=s(this,e.call(this,a,n));return l.handleJump=function(e){var t=l.props.total,a=l.state,r=a.current,s=a.currentPageSize,n=a.inputValue,o=ce(t,s),i=parseInt(n,10);isNaN(i)?i="":i<1?i=1:i>o&&(i=o),i&&i!==r&&l.onPageItemClick(i,e),l.setState({inputValue:""})},l.state={current:a.defaultCurrent||1,currentPageSize:0,inputValue:""},l}return a(t,e),t.getDerivedStateFromProps=function e(t,a){var r=t.current,s=t.total,n=t.pageSize,l={},o=pe(r||a.current,s,n);return a.current!==o&&(l.current=o),a.currentPageSize!==n&&(l.currentPageSize=n),l},t.prototype.onPageItemClick=function e(t,a){"current"in this.props||this.setState({current:t}),this.props.onChange(t,a)},t.prototype.onInputChange=function e(t){this.setState({inputValue:t})},t.prototype.onSelectSize=function e(t){var a={currentPageSize:t},r=ce(this.props.total,t);this.state.current>r&&(a.current=r),this.setState(a),this.props.onPageSizeChange(t)},t.prototype.renderPageTotal=function e(){var t=this.props,a=t.prefix,r=t.total,s=t.totalRender,l=this.state,o=l.currentPageSize,i=l.current,p=[(i-1)*o+1,i*o];return n.createElement("div",{className:a+"pagination-total"},s(r,p))},t.prototype.renderPageItem=function e(t){var a,r=this.props,s=r.prefix,p=r.size,c=r.link,m=r.pageNumberRender,u=r.total,d=r.pageSize,g=r.locale,f=this.state.current,h=ce(u,d),y=parseInt(t,10)===f,E={size:p,className:l((a={},a[s+"pagination-item"]=!0,a[s+"current"]=y,a)),onClick:y?ie:this.onPageItemClick.bind(this,t)};return c&&(E.component="a",E.href=c.replace("{page}",t)),n.createElement(_,o({"aria-label":i.template(g.total,{current:t,total:h})},E,{key:t}),m(t))},t.prototype.renderPageFirst=function e(t){var a,r=this.props,s=r.prefix,c=r.size,m=r.shape,u=r.locale,d,g={disabled:t<=1,size:c,className:l((a={},a[s+"pagination-item"]=!0,a[s+"prev"]=!0,a)),onClick:this.onPageItemClick.bind(this,t-1)},f=n.createElement(p,{type:"arrow-left",className:s+"pagination-icon-prev"});return n.createElement(_,o({},g,{"aria-label":i.template(u.labelPrev,{current:t})}),f,"arrow-only"===m||"arrow-prev-only"===m||"no-border"===m?"":u.prev)},t.prototype.renderPageLast=function e(t,a){var r,s=this.props,c=s.prefix,m=s.size,u=s.shape,d=s.locale,g,f={disabled:t>=a,size:m,className:l((r={},r[c+"pagination-item"]=!0,r[c+"next"]=!0,r)),onClick:this.onPageItemClick.bind(this,t+1)},h=n.createElement(p,{type:"arrow-right",className:c+"pagination-icon-next"});return n.createElement(_,o({},f,{"aria-label":i.template(d.labelNext,{current:t})}),"arrow-only"===u||"no-border"===u?"":d.next,h)},t.prototype.renderPageEllipsis=function e(t){var a=this.props.prefix;return n.createElement(p,{className:a+"pagination-ellipsis "+a+"pagination-icon-ellipsis",type:"ellipsis",key:"ellipsis-"+t})},t.prototype.renderPageJump=function e(){var t=this,a=this.props,r=a.prefix,s=a.size,l=a.locale,o=this.state.inputValue;return[n.createElement("span",{className:r+"pagination-jump-text"},l.goTo),n.createElement(j,{className:r+"pagination-jump-input",type:"text","aria-label":l.inputAriaLabel,size:s,value:o,onChange:this.onInputChange.bind(this),onKeyDown:function e(a){a.keyCode===c.ENTER&&t.handleJump(a)}}),n.createElement("span",{className:r+"pagination-jump-text"},l.page),n.createElement(_,{className:r+"pagination-jump-go",size:s,onClick:this.handleJump},l.go)]},t.prototype.renderPageDisplay=function e(t,a){var r=this.props,s=r.prefix,l=r.pageNumberRender;return n.createElement("span",{className:s+"pagination-display"},n.createElement("em",null,l(t)),"/",l(a))},t.prototype.renderPageList=function e(t,a){var r=this.props,s=r.prefix,l=r.pageShowCount,o=[];if(a<=l)for(var i=1;i<=a;i++)o.push(this.renderPageItem(i));else{var p=l-3,c=parseInt(p/2,10),m=void 0,u=void 0;o.push(this.renderPageItem(1)),u=t+c,(m=t-c)<=1&&(u=(m=2)+p),m>2&&o.push(this.renderPageEllipsis(1)),u>=a-1&&(u=a-1,m=a-1-p);for(var d=m;d<=u;d++)o.push(this.renderPageItem(d));u<a-1&&o.push(this.renderPageEllipsis(2)),o.push(this.renderPageItem(a))}return n.createElement("div",{className:s+"pagination-list"},o)},t.prototype.renderPageSizeSelector=function e(){var t=this.props,a=t.prefix,r=t.pageSizeSelector,s=t.locale,l=n.createElement("span",{className:a+"pagination-size-selector-title"},s.pageSize);switch(r){case"filter":return n.createElement("div",{className:a+"pagination-size-selector"},l,this.renderPageSizeFilter());case"dropdown":return n.createElement("div",{className:a+"pagination-size-selector"},l,this.renderPageSizeDropdown());default:return null}},t.prototype.renderPageSizeFilter=function e(){var t=this,a=this.props,r=a.prefix,s=a.size,o=a.pageSizeList,i=this.state.currentPageSize;return n.createElement("div",{className:r+"pagination-size-selector-filter"},o.map((function(e,a){var o,p=void 0,c=void 0;e.value?(p=e.label,c=e.value):p=c=e;var m=l(((o={})[r+"pagination-size-selector-btn"]=!0,o[r+"current"]=c===i,o));return n.createElement(_,{key:a,text:!0,size:s,className:m,onClick:c!==i?t.onSelectSize.bind(t,c):null},p)})))},t.prototype.renderPageSizeDropdown=function e(){var t=this.props,a=t.prefix,r=t.size,s=t.pageSizeList,l=t.locale,i=t.popupProps,p=t.selectProps,c=this.state.currentPageSize;return n.createElement($,o({className:a+"pagination-size-selector-dropdown",popupClassName:a+"pagination-size-selector-popup",popupProps:i,"aria-label":l.selectAriaLabel,autoWidth:!1,size:r,value:c,onChange:this.onSelectSize.bind(this)},p),s.map((function(e,t){var a=void 0,r=void 0;return e.value?(a=e.label,r=e.value):a=r=e,n.createElement(oe,{key:t,value:r},a)})))},t.prototype.render=function e(){var a,r=this,s=this.props,i=s.prefix;s.pure;var p=s.rtl,c=s.device,u=s.type,d=s.size,g=s.shape,h=s.className,y=s.total,E=s.totalRender,v=s.pageSize,x=s.pageSizeSelector;s.pageSizeList;var b=s.pageSizePosition,N=s.useFloatLayout;s.onPageSizeChange;var S=s.hideOnlyOnePage,k=s.showJump;s.locale,s.current,s.defaultCurrent;var P=s.pageShowCount;s.pageNumberRender,s.link,s.onChange,s.popupProps,s.selectProps;var C=m(s,["prefix","pure","rtl","device","type","size","shape","className","total","totalRender","pageSize","pageSizeSelector","pageSizeList","pageSizePosition","useFloatLayout","onPageSizeChange","hideOnlyOnePage","showJump","locale","current","defaultCurrent","pageShowCount","pageNumberRender","link","onChange","popupProps","selectProps"]),I=this.state,w=I.current,z,O=ce(y,I.currentPageSize),_=this.renderPageFirst(w),j=this.renderPageLast(w,O),L=this.renderPageSizeSelector(),T="start"===b,D=u;"phone"===c&&"normal"===D&&(D="simple");var R=l(((a={})[i+"pagination"]=!0,a[""+i+d]=d,a[""+i+D]=D,a[""+i+g]=g,a[i+"start"]=!!x&&T&&N,a[i+"end"]=!!x&&!T&&N,a[i+"hide"]=O<=1&&S,a[h]=!!h,a));p&&(C.dir="rtl");var Y=function e(){for(var a=arguments.length,s=Array(a),l=0;l<a;l++)s[l]=arguments[l];return n.createElement("div",o({className:R},f.pickOthers(Object.keys(t.propTypes),C)),T&&L,E?r.renderPageTotal():null,n.createElement("div",{className:i+"pagination-pages"},s.map((function(e,t){return e&&n.cloneElement(e,{key:t})}))),!T&&L)};switch(D){case"mini":return Y(_,j);case"simple":var $;return Y(_,this.renderPageDisplay(w,O),j);case"normal":var H=this.renderPageList(w,O),G=k&&y>v*P?this.renderPageDisplay(w,O):null,M=k&&y>v*P?this.renderPageJump(w,O):null;return Y.apply(void 0,[_,H,j,G].concat(M));default:return null}},t}(u.exports.Component),ne.propTypes=o({},e.propTypes,{prefix:d.string,pure:d.bool,rtl:d.bool,device:d.oneOf(["desktop","tablet","phone"]),className:d.string,locale:d.object,type:d.oneOf(["normal","simple","mini"]),shape:d.oneOf(["normal","arrow-only","arrow-prev-only","no-border"]),size:d.oneOf(["small","medium","large"]),current:d.number,defaultCurrent:d.number,onChange:d.func,total:d.number,totalRender:d.func,pageShowCount:d.number,pageSize:d.number,pageSizeSelector:d.oneOf([!1,"filter","dropdown"]),pageSizeList:d.oneOfType([d.arrayOf(d.number),d.arrayOf(d.shape({label:d.string,value:d.number}))]),pageNumberRender:d.func,pageSizePosition:d.oneOf(["start","end"]),useFloatLayout:d.bool,onPageSizeChange:d.func,hideOnlyOnePage:d.bool,showJump:d.bool,link:d.string,popupProps:d.object,selectProps:d.object}),ne.defaultProps={prefix:"next-",pure:!1,rtl:!1,locale:g.Pagination,type:"normal",shape:"normal",size:"medium",defaultCurrent:1,onChange:ie,pageSize:10,pageSizeSelector:!1,pageSizeList:[5,10,20],pageSizePosition:"start",onPageSizeChange:ie,useFloatLayout:!1,total:100,pageShowCount:5,hideOnlyOnePage:!1,showJump:!0,pageNumberRender:function e(t){return t}},le);me.displayName="Pagination";var ue=e.config(t(me)),de=function(){return de=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},de.apply(this,arguments)},ge=h.Tooltip,fe=n.forwardRef((function(e,t){return n.createElement(ge,de({delay:150},e,{popupProps:de({animation:{in:"fadeIn",out:"fadeOut"}},e.popupProps),ref:t}))})),he=n.forwardRef((function(e,t){return n.createElement(h,de({animation:{in:"fadeIn",out:"fadeOut"}},e,{ref:t}))}));he.Tooltip=fe;var ye=he,Ee=function(){return Ee=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Ee.apply(this,arguments)},ve,xe=L((function(e){var t=y("--alicloudfe-components-theme").trim(),a=t.startsWith("hybridcloud")||t.startsWith("yunxiao")?"arrow-only":"normal";return n.createElement(ue,Ee({shape:a},e))})),be={LIGHT_STEEL_BLUE:"light-steel-blue",PLUM:"plum",MISTY_ROSE:"misty-rose",LIGHT_GOLDENROD_YELLOW:"light-goldenrod-yellow",PALE_GREEN:"pale-green",SILVER:"silver",GRAY:"gray"},Ne="wind-tag-colored",Se="wind-tag-colored-group",ke="__WIND_TAG_",Pe=function(){return Pe=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},Pe.apply(this,arguments)},Ce=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]]);return a},Ie=function(e){var t=e.type,a=e.className,r=Ce(e,["type","className"]);return n.createElement(H,Pe({},r,{className:l("wind-tag-colored","wind-tag-colored-"+t,a)}))};Ie.propTypes=Pe(Pe({},H.propTypes),{type:d.oneOf(Object.values(be)),className:d.string}),Ie.defaultProps={type:be.LIGHT_STEEL_BLUE},Ie.__WIND_TAG_="Tag";var we=Ie,ze=function(){return ze=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},ze.apply(this,arguments)},Oe=H.Group,_e=[be.LIGHT_STEEL_BLUE,be.PLUM,be.MISTY_ROSE,be.LIGHT_GOLDENROD_YELLOW,be.PALE_GREEN],je=function(e){var t=e.className,a=e.style,r=e.avaliableColors,s=void 0===r?_e:r,o=e.children;return n.createElement(Oe,{className:l("wind-tag-colored-group",t),style:a},u.exports.Children.map(o,(function(e,t){var a=e;try{var r;"Tag"===e.type.__WIND_TAG_&&(a=n.createElement(we,ze({},e.props,{type:s[t%5]})))}catch(l){}return a})))};je.propTypes={className:d.string,style:d.objectOf(d.any),avaliableColors:d.arrayOf(d.string),children:d.node};var Le=je;function Te(e){return e.Colored=we,e.ColoredGroup=Le,e.__WIND_TAG_="Tag",e}var De=function(){return De=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},De.apply(this,arguments)},Re=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]]);return a},Ye=Te(L(n.forwardRef((function(e,t){var a,r=e.children,s=e.color,o=e.prefix,i=void 0===o?"next-":o,p=e.className,c=Re(e,["className"]),m=y("--alicloudfe-components-theme").trim();return"hybridcloud"===m||"hybridcloud-dark"===m||"yunxiao"===m||"yunxiao-dark"===m?n.createElement(H,De({ref:t,className:l((a={},a[i+"tag-custom-"+s]=!0,a),p)},c),r):n.createElement(H,De({},e,{ref:t}),r)}))));E(Ye,H),Ye.displayName=H.displayName;var $e=Ye;const He=e=>{const{taskId:t,refreshCallback:a,updatedTime:r}=e,{loading:s,request:l}=v(C),o=()=>{D.confirm({title:n.createElement("h3",{style:{margin:0}},`\u5220\u9664\u7248\u672c ${t}`,n.createElement("span",{className:"fz-12",style:{color:"#787878"}},"(",r,")")),content:n.createElement("span",{style:{fontSize:12}},"\u5f53\u524d\u64cd\u4f5c\u4ec5\u5220\u9664\u90e8\u7f72\u8bb0\u5f55\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5df2\u90e8\u7f72\u7684\u73af\u5883\u8d44\u6e90\uff0c\u60a8\u786e\u5b9a\u8981\u5220\u9664\u7248\u672c\u8bb0\u5f55"),onOk:async()=>{await l({taskId:t}),a&&a()}})};return n.createElement(T,{type:"primary",text:!0,onClick:o,disabled:s},"\u5220\u9664")};var Ge=u.exports.memo(He);const Me=({label:e,url:t,icon:a=!0,className:r="",self:s=!1,checker:l=!1,noSpm:o=!1,handelClick:i=(()=>{})})=>{const p=o?{"data-spm-protocol":"i"}:{};return n.createElement("a",{className:r,...p,href:t,onClick:()=>i(),target:s?"_self":"_blank",rel:"noopener noreferrer"},n.createElement("span",{style:{wordBreak:"break-all"}},e))};var Fe=u.exports.memo(Me);const Ae=ye.Tooltip,Ve=({url:e,label:t,icon:a=!1,className:r,message:s})=>n.createElement(Fe,{className:`color-gray cursor-pointer ${r}`,url:e,label:t?s?n.createElement(Ae,{trigger:n.createElement("span",{className:"p-2",style:{background:"#eee"}},null==t?void 0:t.slice(0,7)),align:"t"},s):n.createElement("span",{className:"p-2",style:{background:"#eee"}},null==t?void 0:t.slice(0,7)):"",icon:a});var Be=u.exports.memo(Ve);const Je=e=>{const{refreshCallback:t,styleObj:a}=e,r=()=>{t&&t()};return n.createElement(T,{style:a,onClick:r},n.createElement(p,{type:"redo"}))};var We=u.exports.memo(Je);const qe=e=>{const{appId:t,latestTaskId:a}=e,{loading:r,data:s,request:l,refresh:o}=v(I),[i,p]=u.exports.useState([]),[c,m]=u.exports.useState(0);u.exports.useEffect((()=>{l({appId:t,currentPage:1})}),[t]),u.exports.useEffect((()=>{p(x.exports.get(s,"result",[])),m(Number(x.exports.get(s,"totalCount",0)))}),[s]);const d=[{title:"\u90e8\u7f72\u7248\u672c",dataIndex:"id",cell:e=>n.createElement(n.Fragment,null,n.createElement(b,{className:"commit-description",to:`/application/${t}/detail/${e}`},e),a===e&&n.createElement($e,{color:"orange",size:"small",style:{fontStyle:"italic",marginLeft:8}},"Latest")),width:200},{title:"\u6700\u65b0\u63d0\u4ea4",dataIndex:"commit",cell:(e,t,a)=>{const r=x.exports.get(a,"provider","github"),s=x.exports.get(a,"username"),l=x.exports.get(a,"repo_name"),o=x.exports.get(a,"branch"),i=x.exports.get(a,"message");return n.createElement("div",null,n.createElement("span",null,o),n.createElement("div",null,n.createElement(Be,{url:`https://${r}.com/${s}/${l}/commit/${e}`,label:e,icon:!1}),n.createElement("span",{style:{fontSize:12,color:"#888",marginLeft:8}},i)))},width:250},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_time",cell:e=>n.createElement("span",null,N(e).format("YYYY-MM-DD HH:mm:ss"))},{title:"\u66f4\u65b0\u65f6\u95f4",dataIndex:"updated_time",cell:e=>n.createElement("span",null,N(e).format("YYYY-MM-DD HH:mm:ss"))},{title:"\u90e8\u7f72\u72b6\u6001",dataIndex:"status",cell:e=>n.createElement(O,{status:e})},{title:"\u64cd\u4f5c",dataIndex:"id",cell:(e,a,r)=>{const s=N(x.exports.get(r,"updated_time")).format("YYYY-MM-DD HH:mm:ss");return n.createElement(Ge,{appId:t,taskId:e,refreshCallback:o,updatedTime:s})}}],g=e=>{l({appId:t,currentPage:1,taskId:e})},f=e=>{l({appId:t,currentPage:e})};return n.createElement("div",{style:{padding:"0"}},n.createElement("div",{className:"flex-r",style:{justifyContent:"space-between"}},n.createElement(z,{key:"2",shape:"simple",placeholder:"\u901a\u8fc7\u90e8\u7f72\u7248\u672c\u8fdb\u884c\u641c\u7d22",onSearch:g,hasClear:!0,style:{width:"400px"}}),n.createElement(We,{styleObj:{marginLeft:8},refreshCallback:o})),n.createElement(R,{columns:d,hasBorder:!1,dataSource:i,loading:r,style:{margin:"10px 0 15px"}}),n.createElement(xe,{showJump:!1,total:c,onChange:f,style:{textAlign:"right"}}))};var Ue=u.exports.memo(qe);const Ke=e=>{const{disabled:t,refreshCallback:a,appId:r,application:s}=e,[l,o]=u.exports.useState(!1),[i,c]=u.exports.useState(!1),[m,d]=u.exports.useState(""),{request:g}=v(w),f=v(I);u.exports.useEffect((()=>{l&&f.request({appId:r,currentPage:1})}),[l]);const h=()=>{o(!1)},y=async()=>{c(!0);const{success:e,data:t}=await g({taskId:m});e&&(await A(2800),S.success("\u90e8\u7f72\u6210\u529f"),a&&a(t.taskId)),c(!1),h()},E=e=>{d(e)};return n.createElement(n.Fragment,null,n.createElement(T,{disabled:t,className:"ml-8",style:{width:76},onClick:()=>o(!0)},"\u56de\u6eda"),n.createElement(D,{title:n.createElement("div",null,n.createElement(p,{size:"small",type:"warning",style:{color:"#ffc440",marginRight:8}}),"\u56de\u6eda"),autoFocus:!0,visible:l,onOk:h,onClose:h,style:{width:600},className:"rollback-dialog",footer:[n.createElement(T,{type:"primary",onClick:y,loading:i},"\u786e\u5b9a"),n.createElement(T,{type:"normal",onClick:h,disabled:i},"\u53d6\u6d88")]},n.createElement("p",{style:{marginTop:0}},"\u5f53\u524d\u64cd\u4f5c\u5c06\u57fa\u4e8e\u7248\u672c\u60a8\u6307\u5b9a\u7684\u5386\u53f2\u7248\u672c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u90e8\u7f72\u7248\u672c\uff0c\u8bf7\u9009\u62e9\u7248\u672c\u540e\u70b9\u51fb\u786e\u8ba4\u3002"),n.createElement(G,{placeholder:"\u8bf7\u9009\u62e9\u7248\u672c",style:{width:"100%"},autoWidth:!0,disabled:f.loading,onChange:E,dataSource:x.exports.map(x.exports.get(f.data,"result",[]),(e=>({...e,value:e.id,disabled:"success"!==e.status||e.id===x.exports.get(s,"latest_task.taskId"),label:n.createElement("div",{className:"space-between"},n.createElement("span",null,n.createElement(O,{status:e.status,showLabel:!1}),n.createElement("span",{className:"ml-8 mr-8"},e.id),e.message&&`( ${e.message} )`,e.id===x.exports.get(s,"latest_task.taskId")&&n.createElement("span",{className:"ml-8"},"\u5f53\u524d\u90e8\u7f72\u7248\u672c")))})))})))};var Ze="";let Qe=null;const{Row:Xe,Col:et}=K,tt=e=>{const{appId:t,latestTaskId:a,application:r,refreshCallback:s}=e,{loading:l,data:o,request:i,refresh:p}=v(I),[c,m]=u.exports.useState(!1),[d,g]=u.exports.useState(!1),[f,h]=u.exports.useState([]),[y,E]=u.exports.useState(null),S=["pending","running"];u.exports.useEffect((()=>()=>{Qe&&(clearInterval(Qe),Qe=null)}),[]),u.exports.useEffect((()=>{i({appId:t,currentPage:1,pageSize:4})}),[t]),u.exports.useEffect((()=>{h(x.exports.get(o,"result",[])),E(x.exports.get(o,"totalCount",0))}),[o]),u.exports.useEffect((()=>{const e=x.exports.filter(f,(e=>S.includes(e.status)));x.exports.isEmpty(e)||Qe||(s&&s(),g(!0),k())}),[f]);const k=()=>{Qe&&clearInterval(Qe),Qe=setInterval((async()=>{const{result:e}=await I({appId:t,currentPage:1,pageSize:4}),a=x.exports.filter(e,(e=>S.includes(e.status)));x.exports.isEmpty(a)&&(clearInterval(Qe),Qe=null,s&&s(),g(!1)),h(e)}),5e3)};return n.createElement(U,{visible:l,style:{width:"100%"}},n.createElement("div",{className:"flex-r mt-8",style:{justifyContent:"space-between"}},n.createElement("div",null,n.createElement(M,{disabled:x.exports.isEmpty(f)||d,taskId:x.exports.get(r,"latest_task.taskId",""),appId:t,repoName:x.exports.get(r,"repo_name",""),refreshCallback:p}),n.createElement(Ke,{disabled:x.exports.isEmpty(f)||d,appId:t,refreshCallback:p,application:r}),n.createElement(T,{className:"mr-8 ml-8",disabled:!(f&&f.length>0),onClick:()=>m(!0)},"\u67e5\u770b\u5168\u90e8"),!!y&&n.createElement("span",null,"\u5171",y,"\u4e2a\u90e8\u7f72\u7248\u672c")),n.createElement(We,{refreshCallback:p})),f&&f.length>0?n.createElement(n.Fragment,null,n.createElement(Xe,{wrap:!0,className:"projects-container",gutter:8},x.exports.map(f,(e=>{const t=x.exports.get(e,"status"),s=x.exports.get(e,"id"),l=x.exports.get(e,"message"),o=N(x.exports.get(e,"updated_time")).format("YYYY-MM-DD HH:mm:ss"),i=x.exports.get(e,"app_id");return n.createElement(et,{span:"6"},n.createElement("div",{className:"deploy-item mb-8"},n.createElement("div",{className:"flex-r"},n.createElement("div",{className:"copy-trigger flex-r",style:{justifyContent:"flex-start"}},n.createElement(b,{className:"commit-description text-nowrap-1 mr-8",to:`/application/${i}/detail/${s}`},s),n.createElement(Y,{content:s,size:"xs"})),!d&&a===s&&n.createElement($e,{color:"orange",size:"small",style:{fontStyle:"italic"}},"Latest")),n.createElement("div",{style:{fontSize:12,marginBottom:5}},n.createElement("span",{style:{display:"inline-block",width:"100%"}},l),n.createElement("span",{style:{color:"#888",lineHeight:2}},o)),n.createElement("div",{className:"flex-r"},n.createElement(O,{status:t}),S.includes(t)?n.createElement(F,{isText:!0,taskId:x.exports.get(r,"latest_task.taskId",""),appId:i,repoName:x.exports.get(r,"repo_name",""),refreshCallback:p}):n.createElement(Ge,{appId:i,taskId:s,updatedTime:o,refreshCallback:p}))))}))),n.createElement(B,{title:"\u90e8\u7f72\u5386\u53f2",placement:"right",width:900,visible:c,onClose:()=>m(!1)},n.createElement(Ue,{appId:t,latestTaskId:a}))):n.createElement("div",{style:{textAlign:"center",lineHeight:"200px"}},"\u6682\u65e0\u90e8\u7f72\u5386\u53f2"))};var at=u.exports.memo(tt);const{Row:rt,Col:st}=K;class nt extends u.exports.PureComponent{render(){let{title:e,items:t=[],sizePerRow:a=2,padding:r="p-12",editButton:s,content:l,textDescClass:o=""}=this.props;const i=[];t=t.filter((e=>!e.hidden));for(let n=0;n<t.length;n++)n%a==0?i.push([t[n]]):i[i.length-1].push(t[n]);const p=24/a;return n.createElement(n.Fragment,null,e&&n.createElement(rt,null,n.createElement(st,{span:"24"},n.createElement("div",{className:"flex-r"},n.createElement("div",{className:"baseline"},n.createElement("div",{className:"box-hd"},n.createElement("h3",null,i.length>0&&e)),s&&n.createElement("div",{className:"ml-20"},s)),n.createElement("div",null,l)))),i.map(((e,t)=>n.createElement(rt,{key:t},e.map(((e,t)=>n.createElement(st,{key:t,span:p},n.createElement(rt,{className:r},n.createElement(st,{align:"baseline",className:`text-description ${o}`,span:"8"},e.text),n.createElement(st,{align:"baseline",span:"16"},e.value||"--")))))))))}}const lt=e=>{var t,a;const{data:r,refreshCallback:s}=e,l=x.exports.get(r,"description","_"),o=N(x.exports.get(r,"created_time")).format("YYYY-MM-DD HH:mm:ss"),i=x.exports.get(r,"latest_task.status","init"),p=x.exports.get(r,"provider"),c=x.exports.get(r,"repo_url"),m=x.exports.get(r,"repo_name"),u=x.exports.get(r,"owner"),d=x.exports.get(r,"latest_task.commit"),g=x.exports.get(r,"latest_task.taskId"),f=x.exports.get(r,"id");return n.createElement(nt,{title:"\u57fa\u672c\u4fe1\u606f",content:n.createElement(We,{refreshCallback:s}),items:[{text:"\u4ed3\u5e93\u540d\u79f0",value:n.createElement("div",null,n.createElement("span",{className:"fz-12"},u),n.createElement("span",{className:"fz-14 f-w-500"}," / ",m))},{text:"\u63cf\u8ff0",value:l},{text:"\u521b\u5efa\u65f6\u95f4",value:o},{text:"\u90e8\u7f72\u72b6\u6001",value:n.createElement("div",{className:"flex-r",style:{justifyContent:"flex-start"}},n.createElement(O,{status:i}),g&&n.createElement(b,{className:"ml-8",to:`/application/${f}/detail/${g}`},"\u67e5\u770b"))},{text:"\u4ee3\u7801\u6e90",value:n.createElement("div",{className:"align-center"},null==(t=Q[p])?void 0:t.svg(16),n.createElement(Fe,{className:"color-link cursor-pointer ml-4",url:c,label:m}))},d&&{text:"Commit",value:n.createElement("div",{className:"align-center"},null==(a=Q[p])?void 0:a.svg(16),n.createElement(Be,{className:"ml-4",url:`https://${p}.com/${u}/${m}/commit/${d}`,label:x.exports.get(r,"latest_task.commit"),message:x.exports.get(r,"latest_task.message"),icon:!1}))}].filter(Boolean),sizePerRow:2})},ot=({secrets:e={},appId:t,refreshCallback:a,provider:r})=>{const[s,l]=u.exports.useState([]),{loading:o,request:i}=v(X),p=u.exports.useRef();u.exports.useEffect((()=>{l(c(e))}),[e]);const c=e=>x.exports.map(x.exports.keys(e),(t=>({key:t,value:e[t],showPassword:!1}))),m=()=>{var e,t;null==(e=null==p?void 0:p.current)||e.setValue("secrets",s),null==(t=null==p?void 0:p.current)||t.setVisible(!0)},d=async()=>{var e,s;const n=(null==(e=null==p?void 0:p.current)?void 0:e.getValue("secrets"))||[],l={};x.exports.forEach(n,(({key:e,value:t})=>{l[e]=t}));const{success:o}=await i({secrets:l,appId:t,provider:r});o&&(S.success("\u914d\u7f6e\u6210\u529f"),null==(s=null==p?void 0:p.current)||s.closeDrawer(),a&&a())};return n.createElement(J,{title:"\u5bc6\u94a5\u914d\u7f6e",extra:n.createElement(T,{type:"primary",text:!0,onClick:m},"\u7f16\u8f91")},n.createElement(W,{secretList:s,setSecretList:l}),n.createElement(q,{title:"\u7f16\u8f91Secret",loading:o,ref:p,onSubmit:d}))},it=({events:e,provider:t,appId:a,refreshCallback:r})=>{const{request:s,loading:l}=v(X),[o,i]=u.exports.useState(!1),p=Z.useField(),{init:c,setValue:m,validate:d}=p;u.exports.useEffect((()=>{x.exports.isEmpty(e)}),[e]);const g=()=>{d((async(e,n)=>{if(e)return;const l=x.exports.get(n,"trigger",[]),o={[t]:{events:x.exports.map(l,(e=>{const t=e.filterType===te.INPUT?e.input:`body.ref in ["refs/heads/${e.branch}"]`;return{eventName:e.type,filter:e.type===ae.PUSH?t:e.input,template:e.template}}))}};try{const{success:e}=await s({trigger_spec:o,appId:a,provider:t});e&&(S.success("\u914d\u7f6e\u6210\u529f"),r&&r(),i(!1))}catch(p){S.error(p.message)}}))},f=()=>{i(!1),m("trigger",h())},h=()=>e.map((({eventName:e,filter:t,template:a})=>({type:e,template:a,branch:V(t||""),filterType:te.BRANCH})));return n.createElement(J,{title:"\u89e6\u53d1\u914d\u7f6e",extra:n.createElement(T,{type:"primary",text:!0,onClick:()=>i(!0)},"\u7f16\u8f91")},n.createElement(R,{dataSource:e,columns:[{dataIndex:"eventName",title:"\u89e6\u53d1\u65b9\u5f0f"},{dataIndex:"filter",title:"\u8fc7\u6ee4\u89c4\u5219",cell:e=>e||"*"},{dataIndex:"template",title:"\u914d\u7f6e\u6587\u4ef6"}]}),o&&n.createElement(B,{title:"\u7f16\u8f91\u89e6\u53d1\u914d\u7f6e",placement:"right",width:"80%",style:{margin:0},visible:o,onClose:f,className:"dialog-drawer"},n.createElement("div",{className:"dialog-body"},n.createElement(ee,{type:"update",repo:{name:"git-action-test",owner:"wss-git"},...c("trigger",{initValue:h()})})),n.createElement("div",{className:"dialog-footer"},n.createElement(T,{className:"mr-10",type:"primary",loading:l,onClick:g},"\u786e\u5b9a"),n.createElement(T,{type:"normal",onClick:f},"\u53d6\u6d88"))))},pt=undefined,ct=({match:{params:{appId:e}}})=>{const{loading:t,data:a,request:r,refresh:s}=v(re),l=x.exports.get(a,"data.provider"),o=x.exports.get(a,`data.trigger_spec[${l}].events`,[]),i=x.exports.get(a,"data.latest_task.taskId",""),p=x.exports.get(a,"data.repo_name",""),c=x.exports.get(a,"data.secrets",{});u.exports.useEffect((()=>{r({id:e})}),[]),u.exports.useEffect((()=>{if(a&&!a.success){const e=D.alert({title:"\u8be6\u60c5\u4fe1\u606f\u51fa\u9519",content:"\u5f53\u524d\u5e94\u7528\u8be6\u60c5\u51fa\u9519/\u5220\u9664",footer:[n.createElement(T,{type:"primary",onClick:()=>{var t;null==(t=k)||t.push("/"),e.hide()}},"\u8fd4\u56de\u5e94\u7528\u5217\u8868"),n.createElement(T,{onClick:()=>e.hide()},"\u53d6\u6d88")]})}}),[a]);const m=()=>{const t=D.alert({title:`\u5220\u9664\u5e94\u7528\uff1a${p}`,content:"\u60a8\u786e\u5b9a\u5220\u9664\u5f53\u524d\u5e94\u7528\u5417?",onOk:async()=>{var a;const{success:r}=await se({appId:e});r&&(S.success("\u5e94\u7528\u5220\u9664\u6210\u529f"),await A(800),null==(a=k)||a.push("/")),t.hide()}})};return n.createElement(P,{title:"\u5e94\u7528\u8be6\u60c5",subhead:p,breadcrumbs:[{name:"\u5e94\u7528\u5217\u8868",path:"/"},{name:e}],breadcrumbExtra:n.createElement(T,{type:"primary",warning:!0,onClick:m},"\u5220\u9664\u5e94\u7528")},n.createElement(U,{visible:t,style:{width:"100%"}},n.createElement(lt,{data:x.exports.get(a,"data",{}),refreshCallback:s}),n.createElement("hr",{className:"mb-20"}),n.createElement(it,{events:o,provider:l,appId:e,refreshCallback:s}),n.createElement("hr",{className:"mb-20 mt-20"}),n.createElement(ot,{secrets:c,provider:l,appId:e,refreshCallback:s}),n.createElement("hr",{className:"mb-20 mt-20"})),n.createElement(J,{title:"\u90e8\u7f72\u5386\u53f2"},n.createElement(at,{appId:e,application:x.exports.get(a,"data",{}),latestTaskId:i,refreshCallback:s})))};export{ct as default};
